<div class="panel panel-dark panel-alt">
  <div class="panel-heading">
    <h3 class="panel-title">Meetings Map</h3>
  </div>
  <div class="panel-body">
    <p>See your schedule on the map below</p>
    <div id="gmap-marker" style="height: 300px"></div>
  </div><!-- panel-body -->
</div>
<script type="text/javascript">
  var latitude = '<%=request.location.latitude%>';
  var longitude = '<%=request.location.longitude%>';
  var minZoomLevel = 3;
  var map_marker = new GMaps({
    div: '#gmap-marker',
    zoom: minZoomLevel,
    lat: latitude,
    lng: longitude
  });

  <%if meetings.present?%>
    <%meetings.each do |meeting|%>
      var latitude = '<%=meeting.latitude%>';
      var longitude = '<%=meeting.longitude%>';
      var title = '<%=meeting.title%>';
      var time = '<%=meeting.ends_at.present? ? (DateTime.now.in_time_zone(current_user.time_zone) > meeting.ends_at.to_datetime.in_time_zone(current_user.time_zone)+1.hour) : false%>';
      var status = '<%=meeting.status%>';
      var check_in = '<%= check_in(meeting,false)%>';
      var check_out = '<%= !check_in(meeting,false) && check_out(meeting,false)%>';

      var contentString = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<h3 id="firstHeading" class="firstHeading"><%=meeting.title%></h3>'+
      '<div id="bodyContent">'+
      '<p><b>Start at:  </b><%= meeting.starts_at.present? ? meeting.starts_at.to_datetime.in_time_zone(current_user.time_zone).strftime("%a %b %d %Y - %l:%M %p") : ''%>' + '</br>' + '<b>End at:  </b><%= meeting.ends_at.present? ? meeting.ends_at.to_datetime.in_time_zone(current_user.time_zone).strftime("%a %b %d %Y - %l:%M %p") : ''%>' + '</br>' + '<b>Location:  </b><%=meeting.location%>'+ '</br>' + '<a class="btn btn-xs btn-default mr5" id="check_in_<%=meeting.id%>" href="/accounts/check_in?conversation_item_id=<%=meeting.id%>"  data-method="post" style="display:none;"><i class="fa fa-sign-in mr5"></i>Check In</a>' + '<a class="btn btn-xs btn-default mr5" id="check_out_<%=meeting.id%>" href="/accounts/check_out?conversation_item_id=<%=meeting.id%>" data-method="post" style="display:none;"><i class="fa fa-sign-in mr5"></i>Check Out</a>'+'</p>'+'</div>'+
      '</div>';

      // if (status == "scheduled" && !time){
      //   if(check_in){
      //     $('#check_in_<%=meeting.id%>').show();
      //   }
      //   if(check_out){
      //     $('#check_out_<%=meeting.id%>').show();
      //   }
      // }

      var marker = map_marker.addMarker({
        lat: latitude,
        lng: longitude,
        label: title,
        infoWindow:
        {
          content: contentString
        }
      });
    <%end%>
  <%end%>
</script>

<!-- var latitude = '<%#=request.location.latitude%>';
var longitude = '<%#=request.location.longitude%>';
var minZoomLevel = 1;
var map_marker = new GMaps({
  div: '#gmap-marker',
  zoom: minZoomLevel,
  lat: latitude,
  lng: longitude
});

<%#if meetings.present?%>
  <%#meetings.each do |meeting|%>
    var latitude = '<%#=meeting.latitude%>';
    var longitude = '<%#=meeting.longitude%>';
    var title = '<%#=meeting.title%>';
    var address = '<%#=meeting.location%>'
    var account_id = '<%#=meeting.account_id %>'
    var meeting_id = '<%#=meeting.id%>'
    var time = '<%#=meeting.ends_at.present? ? (DateTime.now.in_time_zone(current_user.time_zone) > meeting.ends_at.to_datetime.in_time_zone(current_user.time_zone)+1.hour) : false%>'
    var status = '<%#=meeting.status%>'
    var check_in = '<%#= check_in(meeting,false)%>'
    var check_out = '<%#= !check_in(meeting,false) && check_out(meeting,false)%>'
    var marker = map_marker.addMarker({
      lat: latitude,
      lng: longitude,
      label: title,
      infoWindow:
      {
          content: 'Hello World'
      }
      // click: function(e) {
      //   // if (status == "scheduled" && !time){
      //   //   if(check_in){
      //   //     $('.check_in').show();
      //   //   }
      //   //   if(check_out){
      //   //     $('.check_out').show();
      //   //   }
      //   //   $(".check_in").prop('href','/accounts/check_in?conversation_item_id='+meeting_id)
      //   //   $(".check_out").prop('href','/accounts/check_out?conversation_item_id='+meeting_id)
      //   //   if (check_in || check_out){
      //   //      $(".check-in-check-out-modal-form").modal('show')
      //   //   }
      //   // }
      // }
    });
  <%#end%>
<%#end%> -->

