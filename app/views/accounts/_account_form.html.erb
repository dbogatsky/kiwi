<div class="panel-body panel-body-nopadding">
  
  <!-- BASIC WIZARD -->
  <div id="validationWizard" class="basic-wizard">
    
    <ul class="nav nav-pills nav-justified">
      <li><a href="#vtab1" data-toggle="tab"><span>Step 1:</span> Basic Info</a></li>
      <li><a href="#vtab2" data-toggle="tab"><span>Step 2:</span> Address</a></li>
      <li><a href="#vtab3" data-toggle="tab"><span>Step 3:</span> Contact Details</a></li>
      <li><a href="#vtab4" data-toggle="tab"><span>Step 4:</span> Extra info</a></li>
    </ul>

    <!--<form class="form-horizontal" id="firstForm">-->
    <%= simple_form_for @account, html: { id: "account-add-form", class: "form-horizontal" } do |f| %>
    <div class="tab-content">
      
      <div class="tab-pane" id="vtab1">
          <%= f.input :name, wrapper: :wizard_horizontal_form, label: "Account Name", required: true %>

          <div class="form-group">
            <label class="col-sm-offset-2 col-sm-1 control-label">Account Status<span class="asterisk">*</span></label>
            <div class="col-sm-4">
              <%= f.select( :status_id, options_for_select(AccountStatus.all.collect{ |a| ["#{a.name}", a.id] }), {}, { :class => 'select2' }) %>
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-offset-2 col-sm-1 control-label">Assign To<span class="asterisk">*</span></label>
            <div class="col-sm-4">
                    <%= f.select( :assign_to, options_for_select(@users.collect{ |u| ["#{u.first_name} #{u.last_name}", u.id] }), {}, { :class => 'select2' })%>
            </div>
          </div>
          
          <div class="form-group">
            <label class="col-sm-offset-2 col-sm-1 control-label">Shared With</label>
            <div class="col-sm-4">
              <%= f.select( :shared_with, options_for_select(@users.collect{ |u| ["#{u.first_name} #{u.last_name}", u.id] }), { :include_blank => true}, { :class => 'select2', 'data-placeholder' => "Type name of user you wish to share with"})%>
            </div>
          </div>
      </div>
      <div class="tab-pane" id="vtab2">
        <%= f.fields_for :addresses_attributes do |add| %>
          <%= add.input :street_address, wrapper: :wizard_horizontal_form, required: true, label: "Street Address", :input_html => { :name => "account[addresses_attributes][][street_address]"} %>
          <%= add.input :city, wrapper: :wizard_horizontal_form, required: true, label: "City", :input_html => { :name => "account[addresses_attributes][][city]"} %>
          <%= add.input :postcode, wrapper: :wizard_horizontal_form, required: true, label: "Post/Zipcode", :input_html => { :name => "account[addresses_attributes][][postcode]"} %>
          <%= add.input :region, wrapper: :wizard_horizontal_form, required: true, label: "Province/State", :input_html => { :name => "account[addresses_attributes][][region]"} %>
            
          <div class="form-group">
            <label class="col-sm-offset-2 col-sm-1 control-label">Country<span class="asterisk">*</span></label>
            <div class="col-sm-4">
            <%= add.input_field :country, { required: true, priority: [ "Canada", "United States", "United Kingdom" ],  class: "select2", name: "account[addresses_attributes][][country]" } %>
            </div>
          </div>
        <% end %>
      </div>
      
      <div class="tab-pane" id="vtab3">
        <div class="contact-form-wrap">
        <div class="contact-element" style="padding-bottom: 10px;">
        <%= f.simple_fields_for :contacts_attributes do |c| %>
          <% t = Time.now.to_i %>
          <div class="form-group">
            <label class="col-sm-offset-1 col-sm-1 control-label">Contact<span class="asterisk">*</span></label>
            <div class="col-sm-2">
              <%#= c.input :name, required: true, label: 'Contact', :input_html => { :name => "account[contacts_attributes][][name]" } %>
              <%= c.input_field :name, { required: true, label: 'Contact', name: "account[contacts_attributes][#{t}][name]", class: "form-control", id: "account_contacts_attributes_name_1" } %>
            </div>
            
            <label class="col-sm-1 control-label">Type<span class="asterisk">*</span></label>
            <div class="col-sm-1">
              <%= c.select( :type, options_for_select(Contact::CONTACT_TYPES), {}, { :class => "select2", :name => "account[contacts_attributes][#{t}][type]", :id => "account_contacts_attributes_type_1" } ) %>
            </div>

            <label class="col-sm-1 control-label">Value<span class="asterisk">*</span></label>
            <div class="col-sm-2">
              <%#= c.input :value, required: true, :input_html => { :name => "account[contacts_attributes][][value]"} %>
              <%= c.input_field :value, { required: true, label: 'Value', name: "account[contacts_attributes][#{t}][value]", class: "form-control", id: "account_contacts_attributes_value_1" } %>
            </div>
          </div>
        <% end %>
        </div>
        </div>
        <button class="add-contact-button btn btn-success btn-xs">Add Contact</button>
      </div>

      <div class="tab-pane" id="vtab4">
        <div class="form-group">
          <label class="col-sm-offset-2 col-sm-1 control-label">Avatar</label>
          <div class="col-sm-4">
            <label title="Upload image file" for="inputImage" class="btn btn-primary">
              <%= f.file_field :avatar, { name: "avatar" }  %>
            </label>
          </div>
        </div>
        <%= f.input :about, wrapper: :wizard_horizontal_form, :label => 'About', :input_html => { :rows => 5 }  %>

        <%= f.input :quick_facts, wrapper: :wizard_horizontal_form, :label => 'Quick Facts', :input_html => { :rows => 5 }  %>
        <input type="hidden" name="save">
      </div>
      
      
    </div><!-- tab-content -->
    <% end %>
    <!--</form>-->
    
    <ul class="pager wizard">
      <li class="previous"><a href="javascript:void(0)">Previous</a></li>
      <li class="next"><a href="javascript:void(0)">Next</a></li>
      <li class="next finish" style="display:none;"><a href="javascript:;">Finish</a></li>
    </ul>
    
  </div><!-- #validationWizard -->
  
</div><!-- panel-body -->
<script>
    var max_fields      = 5; //maximum input boxes allowed
    var wrapper         = $(".contact-form-wrap"); //Fields wrapper
    var add_button      = $(".add-contact-button"); //Add button ID
   
    var x = 1; //initlal text box count
    $(add_button).click(function(e){ //on add input button click
        e.preventDefault();
        if(x < max_fields){ //max input box allowed
            x++; //text box increment
            //$(wrapper).append('<div><input type="text" name="mytext[]"/><a href="#" class="remove_field">Remove</a></div>'); //add input box
            //alert("HTML to add = " + $(".contact-element:first").html());
            //<button class="remove-contact-button btn btn-danger btn-xs">Remove</button>
            t = (new Date()).getTime();
            str_html = '\
            <div class="contact-element" id="contact-element-'+x+'" style="padding-bottom: 10px;">\
              <div class="form-group">\
                <label class="col-sm-offset-1 col-sm-1 control-label">Contact<span class="asterisk">*</span></label>\
                <div class="col-sm-2">\
                  <input label="Contact" name="account[contacts_attributes]['+t+'][name]" class="form-control" required id="account_contacts_attributes_name_'+x+'" type="text">\
                </div>\
                <label class="col-sm-1 control-label">Type<span class="asterisk">*</span></label>\
                <div class="col-sm-1">\
                  <select class="select2" id="account_contacts_attributes_type_'+x+'" name="account[contacts_attributes]['+t+'][type]">\
                    <option value="email">email</option>\
                    <option value="fax">fax</option>\
                    <option value="mobile">mobile</option>\
                    <option value="phone">phone</option>\
                  </select>\
                </div>\
                <label class="col-sm-1 control-label">Value<span class="asterisk">*</span></label>\
                <div class="col-sm-2">\
                  <input label="Value" name="account[contacts_attributes]['+t+'][value]" class="form-control" required id="account_contacts_attributes_value_'+x+'" type="text">\
                </div>\
                <div class="col-sm-1"><button class="remove-contact-button btn btn-danger btn-xs">Remove</button></div>\
              </div>\
            </div>';
            $(wrapper).append(str_html);
            $("#account_contacts_attributes_type_"+x).select2({ width: '100%'});
            //$('#account_contacts_attributes_value_'+x).rules('add', { required: true });
            /*$('input[id="account_contacts_attributes_value_'+x+'"]').rules("add", {  // <- apply rule to new field
              required: true
            });*/
            
        }
    });
   
    $(wrapper).on("click",".remove-contact-button", function(e){ //user click on remove text
        e.preventDefault();
        //$(this).parent('div').remove(); x--;
        $(this).closest('div.contact-element').remove(); x--;
    })
</script>