    <%= simple_form_for current_user, url: profile_path do |f| %>   
      <div class="panel panel-default">

      	<div class="panel-heading">
      		<h4 class="panel-title">Edit My Profile</h4>
      		<p>Make changes and click save.</p>
      	</div>

      	<div class="panel-body">
          <div class="form-group">
            <label class="col-sm-3 control-label">Email</label>
            <div class="col-sm-6">
              <%= current_user.email %>
            </div>
          </div>

          <%= f.input :first_name, required: true %>
          <%= f.input :last_name, required: true %>
          <div class="form-group">
            <label class="col-sm-3 control-label">Role<span class="asterisk">*</span></label>
            <div class="col-sm-2">
              <%=select_tag 'role_ids', options_for_select(Role.all.map{|r| [r.name, r.id]}), class: 'select2' %>
            </div>
          </div>

          <%= f.input :title, required: true %>
          

          <div class="form-group">
            <label class="col-sm-3 control-label">Picture</label>
            <div class="col-sm-6">
              <label title="Upload image file" for="inputImage" class="btn btn-primary">
                  <input type="file" accept="image/*" name="avatar" id="inputImage" class="hide">Upload new image
              </label>
              <div class="useravatar">
                <img src="/assets/images/default_account_avatar.png" alt="Picture">
              </div>
            </div>
          </div>
          <%= f.input :locale, input_html: { class: 'form-control input-sm' }, collection: I18n.available_locales, prompt: "Select a locale"%>
          <%= f.input :time_zone, input_html: { class: 'form-control input-sm' }, priority: ActiveSupport::TimeZone.us_zones %>

          <%= f.fields_for :addresses_attributes do |add| %>
            <%st_address = @address.last.street_address rescue nil%>
            <%= add.input :street_address, required: true, label: "Street", :input_html => { :name => "user[addresses_attributes][][street_address]", :value => current_user.addresses.last.street_address}%>
            <%city = @address.last.city rescue nil%>
            <%= add.input :city, required: true, label: "City", :input_html => { :name => "user[addresses_attributes][][city]", :value => current_user.addresses.last.city} %>
            <%postcode = @address.last.postcode rescue nil%>
            <%= add.input :postcode, required: true, label: "Postcode/Zipcode", :input_html => { :name => "user[addresses_attributes][][postcode]", :value => current_user.addresses.last.postcode}%>
            <%address_region = @address.last.region rescue nil%>
            <%= add.input :region, required: true, label: "Province/State", :input_html => { :name => "user[addresses_attributes][][region]", :value => current_user.addresses.last.region} %>
            <div class="form-group">
              <label class="col-sm-3 control-label">Country<span class="asterisk">*</span></label>
              <div class="col-sm-6">
                <%= add.input_field :country, { required: true, priority: [ "Canada", "United States", "United Kingdom" ],  class: "select2", name: "user[addresses_attributes][][country]", selected: current_user.addresses.last.country} %>
              </div>
            </div>
            <% address_id = @address.last.id rescue nil %>
            <%= add.hidden_field :id, value: address_id, name: "user[addresses_attributes][][id]" %>
          <% end %>

          <%= f.simple_fields_for :contacts_attributes do |c| %>
            <div class="form-group">
              <label class="col-sm-3 control-label">Contact Name<span class="asterisk">*</span></label>

              <label class="col-sm-1 control-label">Contact<span class="asterisk">*</span></label>
              <div class="col-sm-2">
                <%= c.select( :type, options_for_select(Contact::CONTACT_TYPES, current_user.contacts.last.type), {}, { :class => "select2", :name => "user[contacts_attributes][][type]"} ) %>
              </div>

              <label class="col-sm-1 control-label">Value<span class="asterisk">*</span></label>
              <div class="col-sm-2">
                <%contact_value = @contact.last.value rescue nil%>
                <%= c.input_field :value, { required: true, label: 'Value', name: "user[contacts_attributes][][value]", class: "form-control", value: current_user.contacts.last.value}%>
                <% contact_id = @contact.last.id rescue nil %>
                <%=c.hidden_field :id, value: contact_id, name: "user[contacts_attributes][][id]" %>
              </div>
            </div>
          <% end %>

      	<div class="panel-footer">
      		<div class="row">
      			<div class="col-sm-6 col-sm-offset-3">
      				<button type="submit" class="btn btn-primary" name="save" id="save">Save</button>&nbsp;
      				<button class="btn btn-default" name="cancel" id="cancel">Cancel</button>
      			</div>
      		</div>		
      	</div><!-- panel-footer -->

      </div>		

    <% end %>

    </div><!-- contentpanel -->
    
  </div><!-- mainpanel -->
    
</section>

<script src="/assets/bootstrap/js/jquery-1.11.1.min.js"></script>
<script src="/assets/bootstrap/js/jquery-migrate-1.2.1.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="/assets/bootstrap/js/modernizr.min.js"></script>
<script src="/assets/bootstrap/js/jquery.sparkline.min.js"></script>
<script src="/assets/bootstrap/js/toggles.min.js"></script>
<script src="/assets/bootstrap/js/retina.min.js"></script>
<script src="/assets/bootstrap/js/jquery.cookies.js"></script>
<script src="/assets/bootstrap/js/jquery-ui-1.10.3.min.js"></script>

<script src="/assets/bootstrap/js/custom.js"></script>

<script src="/assets/bootstrap/js/cropper.min.js"></script>

<style>
.user-avatar {
  width: 100%;
}

.user-avatar > img {
  max-width: 100%;
}
</style>


<script>
  var $image = $('.useravatar > img'),
      replaced;
  
  $image.cropper({
    aspectRatio: 1 / 1,
    movable: false,
    zoomable: false,
    rotatable: false,
    scalable: false
  });

  var $inputImage = $("#inputImage");
  if (window.FileReader) {
      $inputImage.change(function() {
          var fileReader = new FileReader(),
                  files = this.files,
                  file;
  
          if (!files.length) {
              return;
          }
  
          file = files[0];
  
          if (/^image\/\w+$/.test(file.type)) {
              fileReader.readAsDataURL(file);
              fileReader.onload = function () {
                  $inputImage.val("");
                  $image.cropper("reset", true).cropper("replace", this.result);
              };
          } else {
              showMessage("Please choose an image file.");
          }
      });
  } else {
      $inputImage.addClass("hide");
  }

</script>
