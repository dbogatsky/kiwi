<% content_for :pageheader do %> 
  <h2><i class="fa fa-user"></i> My Profile</h2>
<% end %>   
   
    <%= simple_form_for current_user, url: profile_path, method: :patch do |f| %>
      <div class="panel panel-default">

      	<div class="panel-heading">
      		<p>Edit your profile below and click save</p>
      	</div>

      	<div class="panel-body">
          <div class="form-group">
            <label class="col-sm-3 control-label">Email</label>
            <div class="col-sm-6">
              <%= current_user.email %>
            </div>
          </div>
          <%= f.input :first_name, required: true %>
          <%= f.input :last_name, required: true %>
          <div class="form-group">
            <label class="col-sm-3 control-label">Role<span class="asterisk">*</span></label>
            <div class="col-sm-2">
            <%rol = current_user.roles.present? ? current_user.roles.last.id : '' %>
              <%=select_tag "user[role_ids][]", options_for_select(Role.all.map{|c| [c.name, c.id] }, selected: "#{rol}"), {prompt: "select", :class => 'form-control input-sm sel_role'}%>
            </div>
            <%en = (defined?(current_user.entity)).nil? ? 'display: none' : 'display: block' %>
            <div class="show_entity" style="<%=en%>">
              <label class="col-sm-1 control-label">Entity<span class="asterisk">*</span></label>
                <div class="col-sm-2">
                   <%en = (defined?(current_user.entity)).nil? ? '' : current_user.entity.id %>
                   <%=f.select(:company_entity_id, options_for_select(CompanyEntities.all.map{|c| [c.name, c.id] }, selected: "#{en}"), {prompt: "select"}, {:class => 'form-control sel_clear input-sm'})%>
                </div>
            </div>
            <!-- <div class="col-sm-4">
              <label class="col-sm-1 control-label">Locale:<span class="asterisk">*</span></label>
              <%#=f.select(:locale, options_for_select([['English', 1],['French', 2]], selected: current_user.locale), {prompt: "select"}, {:class => 'form-control'})%>
            </div> -->

          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">Locale<span class="asterisk">*</span></label>
            <div class="col-sm-6">
              <%=f.select(:locale, options_for_select([['English', 1],['French', 2]], selected: current_user.locale), {prompt: "select"}, {:class => 'form-control input-sm'})%>
            </div>
          </div>
          <%= f.input :title, required: true %>

          <div class="form-group">
            <label class="col-sm-3 control-label">Picture</label>
            <div class="col-sm-6">
              <!-- <label title="Upload image file" for="inputImage" class="btn btn-primary">
                  <input type="file" name="user[avatar]" id="inputImage" class="hide">Upload new image
              </label>
              <div class="useravatar">
                <img alt="" src="<%#=  current_user.avatar_url %>">
              </div> -->
              <label title="Upload image file" for="inputImage" class="btn btn-white">
                <%= f.file_field :avatar, { name: "user[avatar]" }  %>
              </label>
            </div>
          </div>

          <%#= f.input :locale, input_html: { class: 'form-control input-sm' }, collection: I18n.available_locales, prompt: "Select a locale"%>

          <%= f.input :time_zone, input_html: { class: 'form-control input-sm' }, priority: ActiveSupport::TimeZone.us_zones %>

          <%= f.fields_for :addresses_attributes do |add| %>
            <%st_address = @address.last.street_address rescue nil%>
            <%= add.input :street_address, required: true, label: "Street", :input_html => { :name => "user[addresses_attributes][][street_address]", :value => current_user.addresses.last.street_address}%>
            <%city = @address.last.city rescue nil%>
            <%= add.input :city, required: true, label: "City", :input_html => { :name => "user[addresses_attributes][][city]", :value => current_user.addresses.last.city} %>
            <%postcode = @address.last.postcode rescue nil%>
            <%= add.input :postcode, required: true, label: "Postcode/Zipcode", :input_html => { :name => "user[addresses_attributes][][postcode]", :value => current_user.addresses.last.postcode}%>
            <%address_region = @address.last.region rescue nil%>
            <%= add.input :region, required: true, label: "Province/State", :input_html => { :name => "user[addresses_attributes][][region]", :value => current_user.addresses.last.region} %>
            <div class="form-group">
              <label class="col-sm-3 control-label">Country<span class="asterisk">*</span></label>
              <div class="col-sm-6">
                <%= add.input_field :country, { required: true, priority: [ "Canada", "United States", "United Kingdom" ],  class: "select2", name: "user[addresses_attributes][][country]", selected: current_user.addresses.last.country} %>
              </div>
            </div>
            <% address_id = current_user.addresses.last.id rescue nil %>
            <%= add.hidden_field :id, value: address_id, name: "user[addresses_attributes][][id]" %>
          <% end %>

          <%= f.simple_fields_for :contacts_attributes do |c| %>
            <div class="form-group">
              <label class="col-sm-3 control-label">Phone:</label>
              <div class="col-sm-2">
                <%contact_value = current_user.contacts.first.value rescue nil%>
                <%=c.hidden_field :type, value: 'phone', name: "user[contacts_attributes][][type]" %>
                <%= c.input_field :value, { required: true, label: 'Phone', name: "user[contacts_attributes][][value]", class: "form-control", value: current_user.contacts.first.value}%>
                <% contact_id = current_user.contacts.first.id rescue nil %>
                <%=c.hidden_field :id, value: contact_id, name: "user[contacts_attributes][][id]" %>
              </div>
              <label class="col-sm-1 control-label">Mobile:</label>
              <div class="col-sm-2">
                <%contact_value1 = current_user.contacts.last.value rescue nil%>
                <%=c.hidden_field :type, value: 'mobile', name: "user[contacts_attributes][][type]" %>
                <%= c.input_field :value, { required: true, label: 'Value', name: "user[contacts_attributes][][value]", class: "form-control", value: current_user.contacts.last.value}%>
                <% contact_id1 = current_user.contacts.last.id rescue nil %>
                <%=c.hidden_field :id, value: contact_id1, name: "user[contacts_attributes][][id]" %>
              </div>
            </div>
          <% end %>

      	<div class="panel-footer">
      		<div class="row">
      			<div class="col-sm-6 col-sm-offset-3">
      				<button type="submit" class="btn btn-primary" name="save" id="save">Save</button>&nbsp;
      				<button class="btn btn-default" name="cancel" id="cancel">Cancel</button>
      			</div>
      		</div>
      	</div><!-- panel-footer -->

      </div>

    <% end %>

    </div><!-- contentpanel -->

  </div><!-- mainpanel -->

</section>

<style>
.user-avatar {
  width: 100%;
}

.user-avatar > img {
  max-width: 100%;
}
</style>


<script>

  // var $image = $('.useravatar > img'),
  //     replaced;

  // $image.cropper({
  //   aspectRatio: 1 / 1,
  //   movable: false,
  //   zoomable: false,
  //   rotatable: false,
  //   scalable: false
  // });

  // var $inputImage = $("#inputImage");
  // if (window.FileReader) {
  //     $inputImage.change(function() {
  //         var fileReader = new FileReader(),
  //                 files = this.files,
  //                 file;

  //         if (!files.length) {
  //             return;
  //         }

  //         file = files[0];

  //         if (/^image\/\w+$/.test(file.type)) {
  //             fileReader.readAsDataURL(file);
  //             fileReader.onload = function () {
  //                 $inputImage.val("");
  //                 $image.cropper("reset", true).cropper("replace", this.result);
  //             };
  //         } else {
  //             showMessage("Please choose an image file.");
  //         }
  //     });
  // } else {
  //     $inputImage.addClass("hide");
  // }


$('.sel_role').change(function(){
  if($(this).val() == 1 || $(this).val() == '' )
    {
      $(".show_entity").hide();
      $(".sel_clear").val('');
    }else
    {
     $(".show_entity").show();
    }
});
</script>
