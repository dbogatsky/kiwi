<%if notifications.present?%>
	<table class="table">
	  <thead>
	    <tr>
	      <th></th>
	      <th>Description</th>
	      <th>Date/Time</th>
	      <th>Unread</th>
	    </tr>
	  </thead>
	  <tbody>
	    <%notifications.each do |notification|%>
		    <tr class="show_details i_pointer" 
            id="<%=notification.id%>" 
            data-conversation-id="<%=
              case notification.type
              when 'reminder'
                notification.value.reminder_id
              when 'meeting_reminder'
                notification.value.meeting_id
              when 'account_status_change'
                notification.value.account_id
              end
            %>" 
            data-notification-type="<%=notification.type%>" 
            data-read-notification="<%=notification.read_at.present?%>" 
            data-notification-id="<%=notification.id%>"
          >
		      <%mark_class = notification.read_at.blank? ? 'mark_read' : ''%>
		        <td>
	            <%#=link_to notification.read_at.blank? ? notification_path(k) : "javascript:void(0)", remote: :true, method: :patch, class: "#{mark_class} noti_link_#{k} ", data: {id: "#{k}"} do%>
			          <%if notification.type == 'reminder'%>
			            <span class="thumb notification_calender" style="background: #f0ca45;">
			              <img class="thumb-img" src="/assets/vertical-timeline/img/cd-icon-bell.svg" alt="Reminder">
			            </span>
			          <%elsif notification.type == 'meeting_reminder'%>
				          <span class="thumb notification_calender" style="background:#1cc7c2;">
				            <img class="thumb-img" src="/assets/vertical-timeline/img/cd-icon-calendar.svg" alt="Meeting">
				          </span>
				        <%elsif notification.type == 'account_status_change'%>
					        <span class="thumb notification_calender" style="background: #333;">
					          <img class="thumb-img" src="/assets/vertical-timeline/img/cd-icon-briefcase.svg" alt="Reminder">
					        </span>
					      <%end%>
		          <%#end%>
		        </td>
			        <td class="remove_bold_<%= notification.id %>" style="<%=notification.read_at.blank? ? 'font-weight:bold' : ''%>">
				        <%= notification.title == nil ? "Click to see Details" : notification.title %>
			        </td>
		        <td class="remove_bold_<%= notification.id%>" style="<%=notification.read_at.blank? ? 'font-weight:bold' : ''%>">
		          <%=Chronic.parse(notification.created_at).in_time_zone(current_user.time_zone).strftime("%b %d at %l:%M %p")%>
		        </td>
		        <td class="remove_bold_<%= notification.id %>">
			        <%if notification.read_at.blank?%>
			          <i class="fa fa-exclamation-circle tooltips mr10" data-toggle="tooltip" data-original-title="Unread" ></i>
			        <%end%>
		        </td>
	      </tr>
	    <%end%>
	  </tbody>
	</table>
<%else%>
<p>You have 0 Notifications</p>
<%end%>

<script type="text/javascript">

  $(document).on('click', '.show_details', function(){
    id = $(this).attr('id')
    conversation_id = $(this).data('conversation-id')
    notification_type = $(this).data('notification-type')
    notification_read = $(this).data('read-notification')
    notification_id = $(this).data('notification-id')

    if($(this).next().attr('id') == 'details_tr_'+id) {
      $(this).next().toggle(500)
    } else {
		  $.ajax({
		    type: "GET",
		    url: '/notifications/conversation_detail?item_id='+id+'&conversation_id='+conversation_id+'&notification_type='+notification_type+'&notification_read='+notification_read+'&notification_id='+notification_id,
		    dataType: 'html',
		    success: function (data) {
          console.log(id);
          $('#' + id).after(data)
          $(".remove_bold_"+ id).css('font-weight', 'normal')
          $(".remove_bold_"+ id).last().html('')
		    },
        beforeSend: function() {
          $('#preloader').css('opacity', 0.8);
          $('#preloader').show();
        },
        complete: function() {
          $('#preloader').hide();
        }
		  });
	  }
  })

  $(document).on('click', '.close_div', function(){
    $(this).closest('tr').hide(500);
  })

</script>